@model ChatVM
@{
    var recipientEmail = ViewBag.RecipientEmail as string ?? string.Empty;
    var propertyAddress = ViewBag.PropertyAddress as string ?? string.Empty;
    var propertyCity = ViewBag.PropertyCity as string ?? string.Empty;
    var propertyPrice = ViewBag.PropertyPrice as string ?? string.Empty;
}

<!-- Pass conversation Ids to JavaScript -->
<script>
    // Pass the conversation Ids to JavaScript via the ViewModel
    const conversationIds = @Html.Raw(Json.Serialize(Model.ConversationIds));
    console.log("User's conversation IDs: ", conversationIds);
    window.currentUserId = '@Model.UserId';
</script>

<div class="container mt-4">
    <div class="row mb-3">
        <div class="col text-center">
            <h3>Chat Home</h3>
        </div>
    </div>

    <!-- Chat Control Panel -->
    <div class="row mb-3">
        <div class="col-md-6">
            <label for="senderEmail" class="form-label">Your Email</label>
            <input type="text" class="form-control" id="senderEmail" value="@User.Identity.Name" readonly />
        </div>
        <div class="col-md-6">
            <label for="receiverEmail" class="form-label">Start Chat with (Email)</label>
            <!-- Prepopulate if provided -->
            <input type="text" class="form-control" 
            id="receiverEmail" value="@recipientEmail" 
            placeholder="Enter email to start a private chat" />
        </div>
    </div>
    <div class="row mb-3">
        <div class="col text-end">
            <button id="startChat" class="btn btn-success px-4" disabled>Start Chat</button>
        </div>
    </div>

    <!-- Dynamic Chat Windows -->
    <div id="chatWindows" class="mt-3">
        <div id="chatInfo" 
             data-recipient-email = "@ViewBag.RecipientEmail"
             data-property-address = "@ViewBag.PropertyAddress"
             data-property-city = "@ViewBag.PropertyCity"
             data-property-price = "@ViewBag.PropertyPrice">
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/chat.js"></script>
}

